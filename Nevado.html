<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Nevado de Toluca</title>
    <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
    <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />

    <script defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDc9LqktSq5joZke4iOH_XvqcKup_Je2aQ&callback=initMap">
</script>



<style>
    #listAutenticado #subidaImagenDiv{
      display: none;
    }
</style>

</head>


<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">Toluca Diviértete</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="index.html">Home</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#photos">Galería</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link js-scroll-trigger" href="#mapa">Ubicación</a>
                      </li>
                      <li class="nav-item" id="listRegistro">
                        <a class="nav-link" data-toggle="collapse" data-target="#collapseLogin" href="#login">Iniciar Sesión</a>
                        <div class="collapse" id="collapseLogin">
                          <div class="card card-body">
                            <p><i class="fa fa-sign-in"></i>Iniciar Sesión</p>
                            <div class="formLogin">
                              <div class="form-group" align="left">  
                                <label><i class="fa fa-user"></i>Correo Electrónico</label>
                                <input type="email" class="form-control" name="txtCorreoLog" placeholder="Correo" id="correoLogin" minlength="8" required/>
                            </div>
                            <div class="form-group" align="left">
                                <label><i class="fa fa-eye-slash"></i>Contraseña</label>
                                <input type="password" class="form-control" name="txPasstLog" placeholder="Contraseña" id="passLogin" minlength="6" required/>
                            </div>
                            <p>¿No te haz Registrado? <a href="registro.html">Registro</a></p>
                            <button type="submit" class="btn btn-primary" align="center" id="btnIngresar">
                                <i class="fa fa-sign-in"></i> Iniciar Sesión
                            </button>
                          </div>  
                          </div>
                      </li>
                      <li class="nav-item" id="listAutenticado">
                        <a class="nav-link" data-toggle="collapse" data-target="#collapseAutenticado" id="tabNombre"></a>
                        <div class="collapse" id="collapseAutenticado">
                          <div class="card card-body">
                            <div class="hover-overlay ripple shadow-1-strong rounded" align="center" style="margin-bottom: 1em;">
                              <a href="perfil.html"><i class="fa fa-user"></i>Mi Perfil</a>
                            </div>
                            <button class="btn btn-danger" align="center" id="btnSalir">
                                <i class="fa fa-sign-out"></i> Cerrar Sesión
                            </button>
                          </div>  
                          </div>
                      </li>
                </ul>
            </div>
        </div>
    </nav>

    <!--Header-->
        <header>
            <img class="img-fluid" src="assets/img/mast-nevado.png" alt="" />
        </header>
        <section class="about-section text-center" id="about" style="padding-top: 1rem;">
        <div class="container">
            <div class="row">
              <div class="col-lg-8 mx-auto">
                <h2 class="text-white mb-4"><strong>Nevado de Toluca</strong></h2>
                <p class="text-white-50">
                    Uno de los escenarios naturales más bellos de México. Cuyo mayor tesoro está al llegar al cráter de este extinto volcán, llamado también Xinantécatl, que alcanza una altura de 4,680 metros sobre el nivel del mar. 
                </p>
              </div>
            </div>
          </div>

    </section>

    <!-- Photos-->
    <section class="projects-section bg-light" id="photos">
        <div class="container">
            <!-- Featured Project Row-->
            <div class="row align-items-center no-gutters mb-4 mb-lg-5">

                <section class="p-5 tm-container-outer tm-bg-gray">

                    <!-- The main container DIV starts here -->
                    <div class="container">
                        <div class="row">
                            <!--First row containing the main Heading-->
                            <div class="col-lg-12">
                            </div>
                            <!--Next row containing the respective images in 3x4 grids starts here -->
                            <div id="gallery_div"></div>

                        </div>
                    </div>
                <div id="subidaImagenDiv">
                    <button class="btn btn-sm btn-outline-secondary" id = "btnSubir">
                        Subir Imagen
                      </button>

                <input class="btn-outline-secondary" type="file" accept='image/x-png, image/jpeg, image/jpg' id="btnFoto"/>
                <h6 id="progreso"></h6>
                <div>
                </section>


            </div>

        </div>
    </section>


    <!-- MAP-->

    <section id="mapa">
        <div id="map"></div>
    </section>

    <section class="contact-section bg-black style="margin: 0;">
        
        
        
        
        <div class="social d-flex justify-content-center" style="margin: 0;">
            <a class="mx-2" href="https://github.com/chocoboleda/ProgWebTurismo"><i class="fab fa-github"></i></a>
        </div>
    </section>

    <!-- Footer-->
    <footer class="footer bg-black small text-center text-white-50">
        <div class="container">Copyright © Toluca Diviértete 2021</div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Third party plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>

  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>


  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-auth.js"></script>
  
  
  <script>

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
          apiKey: "AIzaSyDc9LqktSq5joZke4iOH_XvqcKup_Je2aQ",
          authDomain: "sitio-turistico-prog-web.firebaseapp.com",
          projectId: "sitio-turistico-prog-web",
          storageBucket: "sitio-turistico-prog-web.appspot.com",
          messagingSenderId: "943450679611",
          appId: "1:943450679611:web:4e11f096b4f336d6236f1e",
          measurementId: "G-E7N3JRL0GC"
        };

        // Initialize Firebase
        var inicial = firebase.initializeApp(firebaseConfig);
        var database =  inicial.database();
        var storage = inicial.storage();
        var auth = inicial.auth();
        var nombreFoto="";
        var urlFoto ="";
        var archivos = [];
        var usuario;
        var usuarioLogin;
        var usuarioid
        

        //checar autenticación de usuario

        auth.onAuthStateChanged(async function(user){
        if (user){
          document.getElementById("listRegistro").style.display="none";
          document.getElementById("listAutenticado").style.display="block";
          document.getElementById("subidaImagenDiv").style.display="block";
          var userAuth = auth.currentUser;
          if(userAuth!=null){
            await database.ref(`user/${user.uid}`).once("value").then(function (snapshot){
                 usuarioLogin = snapshot.val();
            });
            document.getElementById("tabNombre").innerHTML=usuarioLogin.nombre;
          }
        }else{
          document.getElementById("listRegistro").style.display="block";
          document.getElementById("listAutenticado").style.display="none";
          document.getElementById("subidaImagenDiv").style.display="none";
        }
      })

        //ingresar sesión
        $("#btnIngresar").click(function(){
        var correoLogin = document.getElementById("correoLogin").value;
        var passLogin = document.getElementById("passLogin").value;

        if(correoLogin!==""&&passLogin!==""){
          auth.setPersistence(firebase.auth.Auth.Persistence.SESSION).then(function(){
            auth.signInWithEmailAndPassword(correoLogin,passLogin).then(function (user){
          }).catch(function(error){
            window.alert("Error al Iniciar Sesión: "+error.message);
          });
          }).catch(function(){
            var error = error.message;
            window.alert("Error al Mantener la Sesión: "+error.message);
          });
        }
      });

    /// cerrar sesión
    $("#btnSalir").click(function(){
        auth.signOut().then(function(){
            location.reload();
        }).catch(function(error){
            window.alert("Error al Cerrar la Sesión: "+error.message);
            
          });
      });
        //subir foto
        $("#btnSubir").click( function(){
            usuario ={}
                      subirImagen(); 
            
        });

        
        /// subir imagen
     function subirImagen(){
            nombreFoto = archivos.name;
            var subir = storage.ref(`imagenGaleria/${nombreFoto}`).put(archivos);
            subir.on('state_changed',function(snapshot) {
              var progreso = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              document.getElementById("progreso").innerHTML="Progreso de Subida"+ progreso +"%";
            },
            function (error){
                console.log(error);
            },function(){
              urlFoto=storage.ref(`imagenGaleria/${nombreFoto}`).getDownloadURL().then(function (url){
                urlFoto=url;
                  usuario.foto = urlFoto;
                   database.ref(`Nevado`).push(usuario).then(success =>{     
                                alert("Imagen subida exitosamente");
                                window.location.reload();
                            }).catch((error)=>{
                              console.log(error.message);
                            });
                   
                        });
            });
        }

        $("#btnFoto").change(function(){
              cargarFoto( this );
          });

          function cargarFoto(subida) {   
              if (subida.files && subida.files[0]) {
                  archivos = subida.files[0];
              }
          }



</script>

    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>

    <script type="text/javascript" src="js/gale.js"></script>

    <script>
        // Initialize and add the map
        function initMap() {
          // The location of Uluru
          const ubi = { lat: 19.1786100, lng: -99.8211100 };
          // The map, centered at Uluru
          const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 14,
            center: ubi,
          });
          // The marker, positioned at Uluru
          const marker = new google.maps.Marker({
            position: ubi,
            map: map,
          });
        }


      </script>

<script>
  var rootref = database.ref().child("Nevado");


rootref.on("child_added", snap => {
var image = snap.child("foto").val();

$("#gallery_div").append("<div class='col-md-4 col-xs-6 thumb'><a class='thumbnail' href= "+image+" ><img class='img-responsive' src= "+ image + " alt=''></a>");

}); 
</script>

</body>

</html>